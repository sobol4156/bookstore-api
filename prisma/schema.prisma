generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum BookStatus {
  AVAILABLE // The book is in the library and available for rental/purchase
  RENTED // Currently rented
  SOLD // Sold (if applicable)
  RESERVED // Reserved
  MAINTENANCE // Under maintenance/unavailable
}

enum OrderType {
  PURCHASE
  RENTAL
}

enum RentalDuration {
  TWO_WEEKS
  ONE_MONTH
  THREE_MONTHS
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  name          String?
  role          Role           @default(USER)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  orders        Order[]
  rentals       Rental[]
  notifications Notification[]

  @@index([email])
}

model Order {
  id String @id @default(uuid())

  userId    String
  bookId    String
  type      OrderType
  createdAt DateTime @default(now())

  rental Rental?
  book   Book    @relation(fields: [bookId], references: [id])
  user   User?   @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([bookId])
  @@index([createdAt])
}

model Book {
  id             String     @id @default(uuid())
  title          String
  description    String?
  authorId       String
  categoryId     String
  year           Int?
  priceCents     Int
  rentPriceCents Int
  status         BookStatus @default(AVAILABLE)
  coverUrl       String?
  available      Boolean    @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  author   Author   @relation(fields: [authorId], references: [id])
  category Category @relation(fields: [categoryId], references: [id])
  orders   Order[]
  rentals  Rental[]

  @@index([title])
  @@index([authorId])
  @@index([categoryId])
  @@index([year])
}

model Author {
  id        String    @id @default(uuid())
  name      String
  bio       String?
  createdAt DateTime @default(now())

  books Book[]

  @@index([name])
}

model Category {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime @default(now())

  books Book[]
}

model Rental {
  id             String         @id @default(uuid())
  orderId        String         @unique
  userId         String
  bookId         String
  startAt        DateTime      @default(now())
  endAt          DateTime
  isActive       Boolean        @default(true)
  duration       RentalDuration
  autoReminderAt DateTime

  order Order @relation(fields: [orderId], references: [id])
  user  User  @relation(fields: [userId], references: [id])
  book  Book  @relation(fields: [bookId], references: [id])

  @@index([userId])
  @@index([bookId])
  @@index([endAt])
}

model Notification {
  id        String    @id @default(uuid())
  userId    String
  message   String
  sentAt    DateTime?
  read      Boolean   @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([createdAt])
}
